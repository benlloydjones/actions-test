name: On PR
on:
  pull_request_target:
    types: [ opened, synchronize, reopened ]

jobs:
  build-charts:
    runs-on: ubuntu-latest
    steps:
      - name: Create Kind Cluster
        uses: helm/kind-action@v1.10.0
        with:
          kubectl_version: v1.29.4
          node_image: kindest/node:v1.29.4
          wait: 120s
      - name: Checkout PR latest commit
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_requst.head.sha }}
          path: pr
          fetch-depth: 0
      - name: Template Helm Chart
        shell: bash
        env:
          CHANGED_DIR: /helm/tigera-operator/calico
          VALUES_FILE: values.yaml
          PR: pr
        run: |
          echo "Building chart dependencies Before templating"
          helm dependency update ${PR}${CHANGED_DIR}
